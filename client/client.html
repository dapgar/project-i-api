<!DOCTYPE html>
<html lang="en">

<head>
    <title>Music Track API</title>
    <link rel="stylesheet" type="text/css" href="style.css">

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Function to handle responses
            const handleResponse = async (response, resultElement) => {
                let resultText;
                try {
                    const data = await response.json();
                    resultText = JSON.stringify(data, null, 2);
                } catch (error) {
                    resultText = "Error parsing response.";
                }

                resultElement.textContent = `Status: ${response.status}\n${resultText}`;
            };

            // Function to send requests based on form data
            const sendRequest = async (form) => {
                const method = form.getAttribute("data-method").toUpperCase();
                const endpoint = form.getAttribute("data-endpoint");
                const resultElement = form.nextElementSibling;

                let url = endpoint;
                let options = {
                    method: method,
                    headers: { "Accept": "application/json" },
                };

                if (method === "GET") {
                    // Convert form data to URL parameters
                    const params = new URLSearchParams(new FormData(form)).toString();
                    if (params) url += `?${params}`;

                    console.log(`GET Request URL: ${url}`); // Debugging line
                } else if (method === "POST") {
                    const formData = Object.fromEntries(new FormData(form));
                    options.headers["Content-Type"] = "application/json";
                    options.body = JSON.stringify(formData);
                }

                try {
                    const response = await fetch(url, options);
                    handleResponse(response, resultElement);
                } catch (error) {
                    resultElement.textContent = `Request failed: ${error.message}`;
                }
            };

            // Attach event listeners to all forms
            document.querySelectorAll("form").forEach((form) => {
                form.addEventListener("submit", (event) => {
                    event.preventDefault();
                    sendRequest(form);
                });
            });

            /*document.querySelectorAll(".collapsible").forEach((button) => {
                button.addEventListener("click", () => {
                    const content = button.nextElementSibling;
                    content.style.display = content.style.display === "block" ? "none" : "block";
                });
            });*/

        });
    </script>

</head>

<body>
    <div class="mainContent">
        <a href="https://www.kaggle.com/datasets/jashanjeetsinghhh/songs-dataset">Dataset Link</a>
        <h1>Music API</h1>

        <h2>THIS SCREEN IS NOT FUNCTIONAL YET, GO TO ENDPOINTS DIRECTLY TO TEST RESULTS.</h2>

        <div class="endpoint">
            <h2 class="collapsible">/getAllTracks <span class="methods"><code>GET</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="GET" data-endpoint="/getAllTracks">
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/getTracks <span class="methods"><code>GET</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="GET" data-endpoint="/getTracks">
                        <label>Title Name: <input type="text" name="name"></label><br>
                        <label>Artist: <input type="text" name="artist"></label><br>
                        <label>Min Danceability: <input type="text" name="danceMin"></label><br>
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/getAllArtists <span class="methods"><code>GET</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="GET" data-endpoint="/getAllArtists">
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/getArtists <span class="methods"><code>GET</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="GET" data-endpoint="/getArtists">
                        <label>Artist Name: <input type="text" name="name"></label><br>
                        <label>Min Danceability: <input type="text" name="danceMin"></label><br>
                        <label>Min Song Count: <input type="text" name="songCountMin"></label><br>
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/getFavorites <span class="methods"><code>GET</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="GET" data-endpoint="/getFavorites">
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/addFavorite <span class="methods"><code>POST</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="POST" data-endpoint="/addFavorite">
                        <label>Title: <input type="text" name="name"></label><br>
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>

        <div class="endpoint">
            <h2 class="collapsible">/addTrack <span class="methods"><code>POST</code></span></h2>
            <div class="content">
                <div class="content-box">
                    <h3>Test This Endpoint</h3>
                    <form data-method="POST" data-endpoint="/addTrack">
                        <label>Title: <input type="text" name="name"></label><br>
                        <label>Artist: <input type="text" name="artist"></label><br>
                        <label>Danceability: <input type="text" name="danceability"></label><br>
                        <button type="submit">Send Request</button>
                    </form>
                    <pre class="result"></pre>
                </div>
            </div>
        </div>
    </div>

    <footer>
        Dominic Apgar - IGME.430 - Project I API
    </footer>
</body>

</html>